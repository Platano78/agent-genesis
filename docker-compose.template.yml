# Agent Genesis - Docker Compose Template
# Copy to docker-compose.yml and configure paths for your system
#
# Required environment variables (set in .env file or export):
#   CLAUDE_DESKTOP_LEVELDB_PATH - Path to Claude Desktop LevelDB
#   CLAUDE_PROJECTS_PATH - Path to Claude Code projects directory

version: '3.8'

services:
  agent-genesis:
    container_name: agent-genesis
    build:
      context: .
      dockerfile: Dockerfile
    image: agentgenesis/agent-genesis:latest

    restart: unless-stopped

    ports:
      - "${API_PORT:-8080}:8080"

    environment:
      - APP_MODE=phase2
      - PYTHONPATH=/app
      # Optional: Uncomment to customize
      # - LOG_LEVEL=INFO
      # - API_HOST=0.0.0.0

    volumes:
      # Persistent knowledge database
      - genesis-knowledge:/app/knowledge

      # Claude Desktop LevelDB (read-only)
      # Windows: /mnt/c/Users/YOUR_USERNAME/AppData/Roaming/Claude/Local Storage/leveldb
      # macOS: ~/Library/Application Support/Claude/Local Storage/leveldb
      # Linux: ~/.config/Claude/Local Storage/leveldb
      - type: bind
        source: ${CLAUDE_DESKTOP_LEVELDB_PATH}
        target: /app/data/claude-desktop-leveldb
        read_only: true

      # Claude Code projects directory (read-only)
      # All platforms: ~/.claude/projects
      - type: bind
        source: ${CLAUDE_PROJECTS_PATH}
        target: /app/data/claude-projects
        read_only: true

    networks:
      - agent-genesis-network

    # Resource limits - IMPORTANT for stability
    # ChromaDB + sentence-transformers + FastAPI requires ~3.5GB baseline
    # 6GB limit provides headroom for indexing operations
    mem_limit: 6g
    memswap_limit: 8g

    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 6G
        reservations:
          cpus: '1.0'
          memory: 3G

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  genesis-knowledge:
    driver: local

networks:
  agent-genesis-network:
    driver: bridge
